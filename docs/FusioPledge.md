# FusioPledge

*Pixellete Tech*

> Fusio Pledging Contract

Handles token pledging, tiered rewards distribution, and monthly reward claiming

*Implements double-tiered APR logic, months-based claiming, and admin-controlled configurations*

## Methods

### UPGRADE_INTERFACE_VERSION

```solidity
function UPGRADE_INTERFACE_VERSION() external view returns (string)
```



This function is used to retrieve the version string of the upgrade interface.


#### Returns

| Name | Type | Description |
|---|---|---|
| _0 | string | The version string of the upgrade interface. |

### addSigner

```solidity
function addSigner(address _signer) external nonpayable
```

Adds a backend signer. Only callable by the contract owner.



#### Parameters

| Name | Type | Description |
|---|---|---|
| _signer | address | Address of the signer to be added. |

### calculateMonthlyRewards

```solidity
function calculateMonthlyRewards(uint256 _amount, uint256 _apr) external pure returns (uint256)
```

Helper function to calculate the monthly rewards for a user based on their pledge amount and monthly APR.



#### Parameters

| Name | Type | Description |
|---|---|---|
| _amount | uint256 | The amount of tokens the user pledged. |
| _apr | uint256 | The annual percentage rate (APR) applied to the pledge. |

#### Returns

| Name | Type | Description |
|---|---|---|
| _0 | uint256 | The monthly reward amount for the user pledge. |

### calculateRewards

```solidity
function calculateRewards(address _user) external view returns (uint256, uint256, bool)
```

Helper function to calculate the claimable rewards for a user based on elapsed epochs.

*used for calculating the total rewards claimable by the user based on their pledge status,  and the number of epochs passed.*

#### Parameters

| Name | Type | Description |
|---|---|---|
| _user | address | The address of the user whose rewards are being calculated. |

#### Returns

| Name | Type | Description |
|---|---|---|
| _0 | uint256 | epochsPassed The total number of epochs (time periods) that have passed since the pledge started. |
| _1 | uint256 | claimableReward The amount of rewards the user can claim in the current epoch. |
| _2 | bool | isEnded A boolean indicating whether the pledge has ended and all rewards have been claimed. |

### calculateTotalRewards

```solidity
function calculateTotalRewards(uint256 _amount, uint256 _apr, uint256 _duration) external pure returns (uint256)
```

Helper function to calculate the total rewards based on amount, APR, and duration of interval.



#### Parameters

| Name | Type | Description |
|---|---|---|
| _amount | uint256 | The amount of tokens the user pledged. |
| _apr | uint256 | The annual percentage rate (APR) applied to the pledge. |
| _duration | uint256 | The duration of the pledge, in seconds. |

#### Returns

| Name | Type | Description |
|---|---|---|
| _0 | uint256 | The total rewards that will be distributed to the user. |

### claimRewards

```solidity
function claimRewards(bytes _encodedData, bytes _signature) external nonpayable
```

Claim eligible rewards from an active pledge using off-chain authorization.

*Verifies backend EIP712 signature, signature expiry, validates epochs/months, and updates claimed reward state.*

#### Parameters

| Name | Type | Description |
|---|---|---|
| _encodedData | bytes | ABI-encoded: (amount, interval, id, status, salt) — generated by backend per user context. |
| _signature | bytes | EIP712 signature from backend authorizing the claim. Reverts if: pledge not found or ended, salt reused, signature invalid, too early to claim, no rewards left, user has inufficient token balance or contract reward pool is insufficient. |

### eip712Domain

```solidity
function eip712Domain() external view returns (bytes1 fields, string name, string version, uint256 chainId, address verifyingContract, bytes32 salt, uint256[] extensions)
```



*See {IERC-5267}.*


### emergencyWithdraw

```solidity
function emergencyWithdraw(address _wallet, uint256 _amount) external nonpayable
```

Withdraws tokens from the contract in case of emergency.

*Only callable by the contract owner.*

#### Parameters

| Name | Type | Description |
|---|---|---|
| _wallet | address | Address to receive the withdrawn tokens. |
| _amount | uint256 | Amount of tokens to withdraw. |

### isSigner

```solidity
function isSigner(address) external view returns (bool)
```

Mapping of signer addresses approved to sign off-chain messages



#### Parameters

| Name | Type | Description |
|---|---|---|
| _0 | address | Address of Signer to verify signatures |

#### Returns

| Name | Type | Description |
|---|---|---|
| _0 | bool | Flag to inidcate if given address is a signer |

### owner

```solidity
function owner() external view returns (address)
```



*Returns the address of the current owner.*


#### Returns

| Name | Type | Description |
|---|---|---|
| _0 | address | Address of the current owner |

### pausePledging

```solidity
function pausePledging() external nonpayable
```

Pauses the contract, preventing certain functions from being executed.




### paused

```solidity
function paused() external view returns (bool)
```



*Returns true if the contract is paused, and false otherwise.*


#### Returns

| Name | Type | Description |
|---|---|---|
| _0 | bool | True if contract is paused |

### pledge

```solidity
function pledge(bytes _encodedData, bytes _signature) external nonpayable
```

Pledge user tokens for a specific interval tier after off-chain authorization.

*Validates backend EIP712 signature and stores pledge data on-chain.*

#### Parameters

| Name | Type | Description |
|---|---|---|
| _encodedData | bytes | ABI-encoded: (amount, interval, id, status, salt) — generated by backend based on user-selected amount. |
| _signature | bytes | EIP712 signature from backend authorizing the pledge. Reverts if: tier is inactive, salt is reused, signature is invalid, or user has insufficient token balance. |

### pledges

```solidity
function pledges(address) external view returns (bytes32 id, uint256 amount, uint256 startTime, uint256 endTime, uint256 interval, uint256 totalRewards, uint256 monthlyRewards, uint256 claimedRewards, uint256 lastClaimedEpoch, bool isPledgeEnded)
```

Mapping of user addresses to their pledge information



#### Parameters

| Name | Type | Description |
|---|---|---|
| _0 | address | Address of user with an active Pledge |

#### Returns

| Name | Type | Description |
|---|---|---|
| id | bytes32 | A unique identifer for the user |
| amount | uint256 | Total amount of pledged tokens |
| startTime | uint256 | Timestamp at which user pledged |
| endTime | uint256 | Timestamp at which user pledge ends |
| interval | uint256 | Pledge tier duration in seconds |
| totalRewards | uint256 | Total rewards a user is eligible for |
| monthlyRewards | uint256 | Per month rewards a user is eligible for |
| claimedRewards | uint256 | Total rewards claimed by user |
| lastClaimedEpoch | uint256 | Last epoch at which user claimed rewards |
| isPledgeEnded | bool | True if total rewards are claimed by the user |

### proxiableUUID

```solidity
function proxiableUUID() external view returns (bytes32)
```



*Implementation of the ERC-1822 {proxiableUUID} function. This returns the storage slot used by the implementation. It is used to validate the implementation&#39;s compatibility when performing an upgrade. IMPORTANT: A proxy pointing at a proxiable contract should not be considered proxiable itself, because this risks bricking a proxy that upgrades to it, by delegating to itself until out of gas. Thus it is critical that this function revert if invoked through a proxy. This is guaranteed by the `notDelegated` modifier.*


#### Returns

| Name | Type | Description |
|---|---|---|
| _0 | bytes32 | undefined |

### removeSigner

```solidity
function removeSigner(address _signer) external nonpayable
```

Removes a backend signer. Only callable by the contract owner.



#### Parameters

| Name | Type | Description |
|---|---|---|
| _signer | address | Address of the signer to be removed. |

### renounceOwnership

```solidity
function renounceOwnership() external nonpayable
```



*Leaves the contract without owner. It will not be possible to call `onlyOwner` functions. Can only be called by the current owner. NOTE: Renouncing ownership will leave the contract without an owner, thereby disabling any functionality that is only available to the owner.*


### setTier

```solidity
function setTier(uint256 _interval, uint256 _apr, bool _isActive) external nonpayable
```

Initializes a new pledge tier. Only callable by the contract owner.

*Reverts if the tier already exists or input parameters are invalid.*

#### Parameters

| Name | Type | Description |
|---|---|---|
| _interval | uint256 | Duration of the tier in days (minimum 30) expressed as whole number(e.g., 30 for 30days). |
| _apr | uint256 | APR assigned to the tier, expressed in BPS (e.g., 1600 for 16%). |
| _isActive | bool | Boolean flag to activate the tier upon creation. |

### setTierAPR

```solidity
function setTierAPR(uint256 _interval, uint256 _apr) external nonpayable
```

Updates the APR of an existing tier. Only callable by the contract owner.

*Reverts if tier is inactive or parameters are invalid.*

#### Parameters

| Name | Type | Description |
|---|---|---|
| _interval | uint256 | Duration of the tier whose APR is being updated. |
| _apr | uint256 | New APR value, expressed as BPS (e.g., 1600 for 16%). |

### setTierStatus

```solidity
function setTierStatus(uint256 _interval, bool _status) external nonpayable
```

Updates the status of an existing tier. Only callable by the contract owner.

*Reverts if the new status is the same as the current one.*

#### Parameters

| Name | Type | Description |
|---|---|---|
| _interval | uint256 | Duration of the tier whose status is being updated. |
| _status | bool | New status for the tier (active/inactive). |

### tiers

```solidity
function tiers(uint256) external view returns (uint256 apr, bool isActive)
```

Mapping of the current tiers to get the information about apr and status based on the interval.



#### Parameters

| Name | Type | Description |
|---|---|---|
| _0 | uint256 | Duration of a tier |

#### Returns

| Name | Type | Description |
|---|---|---|
| apr | uint256 | Apr of a tier |
| isActive | bool | Status of a tier |

### token

```solidity
function token() external view returns (contract IERC20)
```

The ERC20 token that users can pledge




#### Returns

| Name | Type | Description |
|---|---|---|
| _0 | contract IERC20 | Fusio token address |

### transferOwnership

```solidity
function transferOwnership(address newOwner) external nonpayable
```



*Transfers ownership of the contract to a new account (`newOwner`). Can only be called by the current owner.*

#### Parameters

| Name | Type | Description |
|---|---|---|
| newOwner | address | Adress of new owner |

### unpausePledging

```solidity
function unpausePledging() external nonpayable
```

Unpauses the contract, allowing functions to be executed again.




### upgradeToAndCall

```solidity
function upgradeToAndCall(address newImplementation, bytes data) external payable
```



*Upgrade the implementation of the proxy to `newImplementation`, and subsequently execute the function call encoded in `data`. Calls {_authorizeUpgrade}. Emits an {Upgraded} event.*

#### Parameters

| Name | Type | Description |
|---|---|---|
| newImplementation | address | undefined |
| data | bytes | undefined |

### usedSalts

```solidity
function usedSalts(bytes32) external view returns (bool)
```

Mapping of used salts to prevent replay attacks in signature verification



#### Parameters

| Name | Type | Description |
|---|---|---|
| _0 | bytes32 | Salt |

#### Returns

| Name | Type | Description |
|---|---|---|
| _0 | bool | Status of salt |



## Events

### Claimed

```solidity
event Claimed(address indexed user, bytes32 id, uint256 amount, uint256 interval, bytes32 status, uint256 rewards, uint256 monthsPassed, uint256 timestamp)
```



*Triggered when a user initiates a pre-claim or reward claim action*

#### Parameters

| Name | Type | Description |
|---|---|---|
| user `indexed` | address | Address of a user |
| id  | bytes32 | Unique identifier assigned to each user who has made a pledge |
| amount  | uint256 | Number of tokens pledged by the user |
| interval  | uint256 | Duration of a tier in seconds |
| status  | bytes32 | Current claim status identifier used for backend processing |
| rewards  | uint256 | Rewards a user claimed |
| monthsPassed  | uint256 | Months passed the pledge start date |
| timestamp  | uint256 | Block timestamp when the claimRewards function is called |


### EmergencyWithdraw

```solidity
event EmergencyWithdraw(address indexed account, uint256 amount)
```



*Triggered when the contract owner withdraw tokens from the contract*


#### Parameters

| Name | Type | Description |
|---|---|---|
| account `indexed` | address | Address given by owner |
| amount  | uint256 | Amount of tokens to withdraw |

### Initialized

```solidity
event Initialized(uint64 version)
```



*Triggered when the contract has been initialized or reinitialized.*

#### Parameters

| Name | Type | Description |
|---|---|---|
| version  | uint64 | undefined |

### IntervalAprUpdated

```solidity
event IntervalAprUpdated(uint256 indexed interval, uint256 apr)
```



*Triggered when the apr of a specific interval is updated*

#### Parameters

| Name | Type | Description |
|---|---|---|
| interval `indexed` | uint256 | Duration of the specific tier |
| apr  | uint256 | Apr in basis points |

### IntervalStatusUpdated

```solidity
event IntervalStatusUpdated(uint256 indexed interval, bool status)
```



*Triggered when the status of a specific interval is updated*


#### Parameters

| Name | Type | Description |
|---|---|---|
| interval `indexed` | uint256 | Duration of the specific tier |
| status  | bool | Current status of the tier |

### OwnershipTransferred

```solidity
event OwnershipTransferred(address indexed previousOwner, address indexed newOwner)
```



*Triggered when the contract ownership is transferred*

#### Parameters

| Name | Type | Description |
|---|---|---|
| previousOwner `indexed` | address | Address of the previous owner |
| newOwner `indexed` | address | Address of the new owner |

### Paused

```solidity
event Paused(address account)
```



*Emitted when the pause is triggered by `account`.*

#### Parameters

| Name | Type | Description |
|---|---|---|
| account  | address | Address of owner who who triggered the contract pause |

### Pledged

```solidity
event Pledged(address indexed user, bytes32 id, uint256 amount, uint256 interval, bytes32 status, uint256 intervalApr, uint256 monthlyApr, uint256 startTime)
```



*Triggered when a user makes a pledge in a specific active tier*

#### Parameters

| Name | Type | Description |
|---|---|---|
| user `indexed` | address | The address of the user making the pledge  |
| id  | bytes32 |  Unique identifier assigned to each user who has made a pledge |
| amount  | uint256 | Number of tokens pledged by the user |
| interval  | uint256 | Duration of a tier in seconds |
| status  | bytes32 | Current pledge status identifier used for backend processing |
| intervalApr  | uint256 |  The APR of the specific interval for which the user made a pledge |
| monthlyApr  | uint256 | The monthly APR of the specific interval for which the user made a pledge |
| startTime  | uint256 |  Block timestamp when the claimRewards function is called |

### SignerAdded

```solidity
event SignerAdded(address indexed signer)
```



*Triggered when a new signer is added*

#### Parameters

| Name | Type | Description |
|---|---|---|
| signer `indexed` | address | Address of the new signer |

### SignerRemoved

```solidity
event SignerRemoved(address indexed signer)
```



*Triggered when as specifc signer is removed*

#### Parameters

| Name | Type | Description |
|---|---|---|
| signer `indexed` | address | Address of the signer to be removed |

### TierSet

```solidity
event TierSet(uint256 indexed interval, uint256 apr, bool status)
```



*Triggered when the owner adds a new tier*

#### Parameters

| Name | Type | Description |
|---|---|---|
| interval `indexed` | uint256 | Duartion of the specific tier |
| apr  | uint256 | Annual Percentage Rate (APR) for the tier, in basis points |
| status  | bool | The status of the tier (active or inactive) |

### Unpaused

```solidity
event Unpaused(address account)
```



*Emitted when the pause is lifted by `account`.*

#### Parameters

| Name | Type | Description |
|---|---|---|
| account  | address | The address of the account that lifted the pause |

### Upgraded

```solidity
event Upgraded(address indexed implementation)
```



*Emitted when the implementation is upgraded.*

#### Parameters

| Name | Type | Description |
|---|---|---|
| implementation `indexed` | address | The address of the new contract implementation |



## Errors

### AddressEmptyCode

```solidity
error AddressEmptyCode(address target)
```



*There&#39;s no code at `target` (it is not a contract).*


### ECDSAInvalidSignature

```solidity
error ECDSAInvalidSignature()
```



*The signature derives the `address(0)`.*


### ECDSAInvalidSignatureLength

```solidity
error ECDSAInvalidSignatureLength(uint256 length)
```



*The signature has an invalid length.*


### ECDSAInvalidSignatureS

```solidity
error ECDSAInvalidSignatureS(bytes32 s)
```



*The signature has an S value that is in the upper half order.*


### ERC1967InvalidImplementation

```solidity
error ERC1967InvalidImplementation(address implementation)
```



*The `implementation` of the proxy is invalid.*


### ERC1967NonPayable

```solidity
error ERC1967NonPayable()
```



*An upgrade function sees `msg.value &gt; 0` that may be lost.*


### EnforcedPause

```solidity
error EnforcedPause()
```



*The operation failed because the contract is paused.*


### ExpectedPause

```solidity
error ExpectedPause()
```



*The operation failed because the contract is not paused.*


### FailedCall

```solidity
error FailedCall()
```



*A call to an address target failed. The target may have reverted.*


### InsufficientBalance

```solidity
error InsufficientBalance()
```



*Thrown when an account does not have enough balance to complete the operation.*


### InsufficientRewardPool

```solidity
error InsufficientRewardPool()
```



*Thrown when an account does not have enough balance to complete the reward distribution for claim.*


### InvalidInitialization

```solidity
error InvalidInitialization()
```



*The contract is already initialized.*


### InvalidInput

```solidity
error InvalidInput()
```



*Emitted when a function receives invalid or unexpected input parameters.*


### InvalidSigner

```solidity
error InvalidSigner()
```



*Raised when the provided signer is not authorized or does not match the expected address.*


### MonthlyTierInactive

```solidity
error MonthlyTierInactive()
```



*Raised when a user attempts to claim monthly rewards from an inactive or disabled monthly tier.*


### NoRewardsLeft

```solidity
error NoRewardsLeft()
```



*Thrown when a user attempts to claim rewards, but all entitled rewards have already been claimed.*


### NotInitializing

```solidity
error NotInitializing()
```



*The contract is not initializing.*


### OwnableInvalidOwner

```solidity
error OwnableInvalidOwner(address owner)
```



*The owner is not a valid owner account. (eg. `address(0)`)*


### OwnableUnauthorizedAccount

```solidity
error OwnableUnauthorizedAccount(address account)
```



*The caller account is not authorized to perform an operation.*


### PledgeBalanceTooLow

```solidity
error PledgeBalanceTooLow()
```



*Thrown when a user’s pledged amount is less than the required amount.
Note: This check is triggered on chain while after pledge a backend cron job actively monitors user balances.*


### PledgeEnded

```solidity
error PledgeEnded()
```



*Thrown when a user attempts to interact with a pledge that has already ended.*


### PledgeNotFound

```solidity
error PledgeNotFound()
```



*Thrown when a pledge cannot be found for the specified user.*


### ReentrancyGuardReentrantCall

```solidity
error ReentrancyGuardReentrantCall()
```



*Unauthorized reentrant call.*


### SaltAlreadyUsed

```solidity
error SaltAlreadyUsed()
```



*Thrown when a salt value has already been used and cannot be reused for a new pledge or claim.*


### SignatureExpired

```solidity
error SignatureExpired()
```



*Thrown when a signature used for a transaction or pledge has expired and is no longer valid.
Note: Signatures for pre-claims are valid for 15 minutes, while signatures for full claims remain valid for up to 2 years.*


### TierInactive

```solidity
error TierInactive()
```



*Thrown when the tier the user is interacting with is no longer active or valid.*


### TierIsActive

```solidity
error TierIsActive()
```



*Thrown when an attempt is made to actiavte an already active tier.*


### TooEarlyToClaim

```solidity
error TooEarlyToClaim()
```



*Thrown when a user attempts to claim rewards before the minimum eligible time.*


### UUPSUnauthorizedCallContext

```solidity
error UUPSUnauthorizedCallContext()
```



*The call is from an unauthorized context.*


### UUPSUnsupportedProxiableUUID

```solidity
error UUPSUnsupportedProxiableUUID(bytes32 slot)
```



*The storage `slot` is unsupported as a UUID.*


